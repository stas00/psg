<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
  <link rel="stylesheet" href="psg.css" type="text/css">
  <LINK REL="SHORTCUT ICON" HREF="favicon.ico" type="image/x-icon"/>
  <META NAME="description" content="System Administrator Pocket Survival Guide -  A series of notes for Sys Admin"/>
  <META NAME="keyword" content="Sys Admin, System Administrator, Solaris, HP-UX, AIX, Linux, Note, Notes, Pocket, Survival, Guide, psg, data center, power, electrical, plug, LYS, LKS, LAPPLAPP, PSG101, sn50, tin6150"/>
  <META NAME="Robots" CONTENT="all"/>
  <META NAME="Author" CONTENT="Tin Ho"/>

  <title>Pocket Survival Guide - Warewulf</title>
</head>

<body> 
<div class="navheader">
<table summary="Navigation header" width="100%">
  <tbody>
    <tr>
      <th colspan="9" align="center">
	  
<A HREF="http://tin6150.github.io/psg/">Sys Admin Pocket Survival Guide - Warewulf</A>

      </th>
    </tr>
    <tr>
      <td align="left">  <a accesskey="h" href="psg.html">Home</a>	</td>
      <td align="center"><a accesskey="x" href="linux.html">linUx</a>	</td>
      <td align="center"><a accesskey="s" href="sol.html">Solaris</a>	</td>
      <td align="center"><a accesskey="p" href="hpux.html">HP-UX</a>	</td>
      <td align="center"><a accesskey="a" href="aix.html">AIX</a>	</td>
      <td align="center"><a accesskey="n" href="netapp.html">NetApp</a>	</td>
      <td align="center"><a accesskey="e" href="emcCelerra.html">EMC(NAS)</a>	</td>
      <td align="center"><a accesskey="E" href="emc.html">EMC(SAN)</a>	</td>
      <td align="center"><a accesskey="v" href="veritas.html">Veritas</a>	</td>
      <td align="right"> <a accesskey="l" href="ldap.html">LDAP</a>	</td>
    </tr>
  </tbody>
</table>
<hr></div>

<div class="chapter" lang="en">
<div class="titlepage">
</div>
</div>


<H1>warewulf</H1>

baremetal provision tool.
common in hpc environment
pxe boot machine, most often run stateless nodes.


<BR><HR><BR>

<H2>Ref</H2>


Good intro/overview <BR>
https://warewulf.readthedocs.io/en/latest/about/architecture.html
<BR><BR>

google group eg:
<BR>
https://groups.google.com/a/lbl.gov/g/warewulf/c/Yx9OMqkyJKU
<BR><BR>

<H2>warewulf backup</H2>


warewulf has a mysql db, running daily dbdump is recommended. <BR>
This stores the node and provision config. <BR>
MySQL/MariaDB config is stored in /etc/warewulf/database*conf <BR>
<BR> <BR>

<PRE>
mysqldump --add-drop-database --opt $DB 
Where $DB is one of 
mysql 
warewulf
</PRE>


/var/chroot contents for the vnfs is NOT in the db, and separate store for that is necessary <BR>
(eg, vnfs build server, pullvnfs script presumed can run again to repopulate this). <BR>
(alt, tar up the existing chroot, xfer the file and untar) <BR>


<H5>db restore</H5>

<PRE>
Restore command (run as root):

bunzip2 -c mysql_backup_mysql_MMDD.sql.bz2    | mysql mysql
bunzip2 -c mysql_backup_warewulf_MMDD.sql.bz2 | mysql warewulf


A few commands to check the restored databases:

mysql -e "describe host" mysql
mysql -e "describe datastore" warewulf
mysql -e "SELECT COUNT(*) FROM user" mysql
mysql -e "SELECT COUNT(*) FROM datastore" warewulf

</PRE>


<H2>network troubleshooting</H2>

<PRE>

If nodes are not PXE booting:

Jul  9 10:40:50 wwulf dhcpd[3849]: DHCPDISCOVER from ff:7b:25:fa:4f:7e via enp0s3: network 10.15.4.0/24: no free leases
Jul  9 10:40:54 wwulf dhcpd[3849]: DHCPDISCOVER from ff:7b:25:fa:4f:7e via enp0s3: network 10.15.4.0/24: no free leases

then try
wwsh -v dhcp update
wwsh dhcp restart
wwsh pxe  update

write to /etc/dhcp/dhpcd.conf
if config has:

   # Evaluating Warewulf node: c0000 (DB ID:887)
   # Skipping c0000: Not on boot network (10.15.14.0)

then:
check /etc/warewulf/provision.conf
the NIC device defined there need to have a network that is within the IP range defined by the wwulf nodes.

Also see:
https://groups.google.com/a/lbl.gov/g/warewulf/c/ERzlDkDw2tY/m/rg-fvAoOacQJ

wwsh bootstrap rebuild
	# recreate files needed by pxe boot, stored in /srv/warewulf/bootstrap

</PRE>

Notes/Ref<BR>

<LI>
VirtualBox iPXE ROM does not support bzImage, but required by some OS like CoreOS (and CentOS?) cuz initramfs is a cpio.bz image.  Thus generating ipxe err 23008001
<A HREF="https://github.com/coreos/tectonic-installer/issues/932">
https://github.com/coreos/tectonic-installer/issues/932</A>

<LI>
Have VBox use EFI instead of bios mode, see 
<A HREF="https://www.makeuseof.com/set-up-efi-linux-virtual-machine-virtualbox/">
https://www.makeuseof.com/set-up-efi-linux-virtual-machine-virtualbox/</A>

<LI>
<TT>virt manager</TT> would be closer to hardware, but a time sink to setup<BR>
proxmox vm should also work fine. <BR>



<H2>Files on boot server</H2>

ensure these files are present.  UEFI may need additional config.

<PRE>

/var/lib/tftpboot/warewulf/
/var/lib/tftpboot/warewulf/ipxe
/var/lib/tftpboot/warewulf/ipxe/bin-i386-pcbios
/var/lib/tftpboot/warewulf/ipxe/bin-i386-pcbios/undionly.kpxe
/var/lib/tftpboot/warewulf/ipxe/bin-i386-pcbios/undionly.kpxe-old
/var/lib/tftpboot/warewulf/ipxe/bin-x86_64-efi
/var/lib/tftpboot/warewulf/ipxe/bin-x86_64-efi/snp.efi
/var/lib/tftpboot/warewulf/ipxe/bin-i386-efi
/var/lib/tftpboot/warewulf/ipxe/bin-i386-efi/snp.efi


/srv/warewulf/initramfs/x86_64/capabilities/provision-adhoc
/srv/warewulf/initramfs/x86_64/capabilities/provision-files
/srv/warewulf/initramfs/x86_64/capabilities/provision-selinux
/srv/warewulf/initramfs/x86_64/capabilities/provision-vnfs
/srv/warewulf/initramfs/x86_64/capabilities/setup-filesystems
/srv/warewulf/initramfs/x86_64/capabilities/transport-http
/srv/warewulf/initramfs/x86_64/capabilities/setup-ipmi

# wwsh bootstrap rebuild # should generate a series of files like:
/srv/warewulf/bootstrap/x86_64/6/kernel
/srv/warewulf/bootstrap/x86_64/6/cookie
/srv/warewulf/bootstrap/x86_64/6/initfs.gz

/srv/warewulf/ipxe/cfg/ac:1f:6b:a5:9c:f6

</PRE>

<H2>special object config</H2>

custom object
<PRE>


wwsh object modify -s LASTOCTET=5   s00
wwsh object modify -s LASTOCTET=100 n00
wwsh object modify -s LASTOCTET=101 n01

wwsh object print -p :all | egrep 'node|name|LASTOCTET'

wwsh --debug file sync # debug mode pring lot of perl code state. eg grep ERROR or WARNING
</PRE>

<H2>config troubleshooting</H2>

<PRE>
wwsh file sync barf like:
WARNING in Warewulf::DataStore::SQL::BaseClass->persist()/861:  Unable to execute set lookup query: Data too long for column 'value' at row 1

or

wwsh file import  /etc/warewulf/files/node_exporter.service --mode=0644 --path=/etc/systemd/system/multi-user.target.wants/node_Exporter.service
wwsh file set node_exporter.service --path=/etc/systemd/system/multi-user.target.wants/node_Exporter.service

WARNING:  Unable to execute set lookup query: Data too long for column 'value' at row 1

it is cuz Destination PATH is limited to at most 65 chars!  use a shorter PATH :-\

</PRE>


<H2>tftp troubleshooting</H2>

tftp (and dhcpd) needs to be running on the warewulf server.
see <A HREF="general_unix.html#tftp">general_unix.html#tftp</A> for troubleshooting info.

<H1>TBD int ref</H1>

<!--
~/CF_BK/sw/warewulf
~/NOTE/node_provision.rst
gretaDev/wwulf...
greta/wwulf_vm/...
-->

<PRE>

</PRE>


<H2>httpd troubleshooting</H2>

Once PXE boot complete via tftp, the image invoke HTTP GET to fetch files from the warewulf servers.
these files are expected to be stored in:
<font face=monospace>
/srv/warewulf 
</font>

<BR><HR><BR>


<BR>
<TT>
Typewriter monospaced fonts in here.
This is another line.
</TT>


<BR>
<BR>
<BR>


<BR><HR>
<div align="CENTER">
  [Doc URL: <A HREF="http://tin6150.github.io/psg/warewulf.html">
http://tin6150.github.io/psg/warewulf.html
</A>] <BR>
Last Updated: 2021-07-20
  <!--[Doc URL: <A HREF="http://tin6150.github.io/psg/">http://tin6150.github.io/psg/</A>] <BR>-->
<BR>
(cc) Tin Ho. See 
<A HREF=psg.html#cc>main page</A>
 for copyright info. <BR>
<HR>
<A HREF="http://www.taos.com"><IMG SRC="banner/taos_banner1.gif" width="728" height="98"></A>
</div>
<div class="sig"><BR>
  hoti1<BR>
  sn5050<BR>
  psg101 sn50 tin6150</div>


</body>

<!-- Google analytics new tracking code ga.js.   Will actually need to add this code to every page for full tracking!    (still the case in 2011?) Using my gmail login 2011.0617 updated with code for http://tin6150.github.io/psg/psg.html -->    <script type="text/javascript">    var _gaq = _gaq || [];   _gaq.push(['_setAccount', 'UA-4515095-4']);   _gaq.push(['_trackPageview']);    (function() {     var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;     ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';     var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);   })();  </script>


</html>
